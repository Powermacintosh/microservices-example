# FastAPI Microservices

ะะธะบัะพ-ัะตัะฒะธัั ะฝะฐ FastAPI ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ PostgreSQL, SQLAlchemy 2.0 ะธ Docker.

## ๐ ะขะตัะฝะพะปะพะณะธะธ

- **FastAPI** - ะฒะตะฑ-ััะตะนะผะฒะพัะบ ะดะปั ัะพะทะดะฐะฝะธั API
- **Uvicorn** - ASGI ัะตัะฒะตั ะดะปั FastAPI
- **SQLAlchemy** - ORM ะดะปั ัะฐะฑะพัั ั ะฑะฐะทะพะน ะดะฐะฝะฝัั
- **PostgreSQL** - ัะตะปััะธะพะฝะฝะฐั ะฑะฐะทะฐ ะดะฐะฝะฝัั
- **Alembic** - ัะฟัะฐะฒะปะตะฝะธะต ะผะธะณัะฐัะธัะผะธ
- **Docker** ะธ **Docker Compose** - ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั
- **Make** - ัะฟัะพัะตะฝะธะต ะบะพะผะฐะฝะด ะดะปั ะทะฐะฟััะบะฐ ะฟัะพะตะบัะฐ
- **Poetry** - ัะฟัะฐะฒะปะตะฝะธะต ะทะฐะฒะธัะธะผะพัััะผะธ
- **Pydantic** - ะฒะฐะปะธะดะฐัะธั ะดะฐะฝะฝัั
- **Loki** - ัะธััะตะผะฐ ะปะพะณะธัะพะฒะฐะฝะธั
- **Grafana** - ัะธััะตะผะฐ ะผะพะฝะธัะพัะธะฝะณะฐ
- **Promtail** - ะธะฝััััะผะตะฝั ะดะปั ัะฑะพัะฐ ะปะพะณะพะฒ
- **Kafka** - ัะธััะตะผะฐ ะพะฑะผะตะฝะฐ ัะพะพะฑัะตะฝะธัะผะธ
- **Kafka-UI** - ะฒะธะทัะฐะปัะฝัะน ะธะฝัะตััะตะนั ะดะปั ัะฐะฑะพัั ั Kafka
- **Locust** - ะธะฝััััะผะตะฝั ะดะปั ะฝะฐะณััะทะพัะฝะพะณะพ ัะตััะธัะพะฒะฐะฝะธั

## ๐ ะะฐะฟััะบ ะฟัะพะตะบัะฐ

### ะขัะตะฑะพะฒะฐะฝะธั

- Docker ะธ Docker Compose
- Python 3.13+
- Poetry
- Make

### ะฃััะฐะฝะพะฒะบะฐ

1. ะะปะพะฝะธััะนัะต ัะตะฟะพะทะธัะพัะธะน:

   ```bash
   git clone https://github.com/powermacintosh/microservices-example.git
   cd microservices-example
   ```

2. ะะฐะฟัััะธัะต ะฟัะธะปะพะถะตะฝะธะต ั ะฟะพะผะพััั Makefile:

```bash
make build  # ะกะฑะพัะบะฐ/ะฟะตัะตัะฑะพัะบะฐ ะฟัะพะตะบัะฐ
make down   # ะััะฐะฝะพะฒะบะฐ ะฟัะพะตะบัะฐ
make up     # ะะฐะฟััะบ ะฟัะพะตะบัะฐ
```

## ๐งช ะะฐะฟััะบ ัะตััะพะฒ

```bash
make test
```

## ๐ ะะพะบัะผะตะฝัะฐัะธั API

ะะพัะปะต ะทะฐะฟััะบะฐ ะดะพะบัะผะตะฝัะฐัะธั API Gateway ะฑัะดะตั ะดะพัััะฟะฝะฐ ะฟะพ ะฐะดัะตัั:

- Swagger UI: http://localhost:5000/docs/
  ![gateway/static/swagger-custom.png](gateway/static/swagger-custom.png)

ะขะฐะบะถะต API Gateway ะฟัะตะดะพััะฐะฒะปัะตั ะฒะพะทะผะพะถะฝะพััั ัะฐะฑะพัั ั API ัะตัะตะท GraphQL:

- GraphQL UI: http://localhost:5000/api/v1/graphql
  ![gateway/static/graphql-interface.png](gateway/static/graphql-interface.png)

## ๐ง ะะฐัััะพะนะบะฐ ะพะบััะถะตะฝะธั ะดะปั ัะฐะทัะฐะฑะพัะบะธ

ะกะพะทะดะฐะนัะต ัะฐะนะป `.env` ะฒ ะบะพัะฝะต ัะตัะฒะธัะฐ
`gateway/`, `tasks/`.
ะะฝะฐะปะพะณะธัะฝะพ ัะฐะนะปั `.env.example`.

```env
MODE = DEVELOPMENT
```

## ๐ ะะพะณะธัะพะฒะฐะฝะธะต ะฒ Grafana

ะะพะณะธ ะฟัะธะปะพะถะตะฝะธั ะพัะฟัะฐะฒะปััััั ะฒ Loki ะธ ะดะพัััะฟะฝั ัะตัะตะท Grafana.
**Grafana**: `http://localhost:3010`

`ะะพะณะธะฝ` - admin
`ะะฐัะพะปั` - admin (ะฟัะธ ะฟะตัะฒะพะผ ะฒัะพะดะต)

### ะะพะดะบะปััะตะฝะธะต Loki ะบ Grafana

#### ะััั ะดะปั ะฟะพะดะบะปััะตะฝะธั Loki ะบ Grafana

`Connections` => `Loki` => `Add new data source`

- **Connection-url**: `http://loki:3100`
- โ๏ธ **Save & Test**

#### ะััั ะดะปั ะฟัะพัะผะพััะฐ ะปะพะณะพะฒ ะฒ Grafana

`Drilldown` => `Logs`

## ๐ฏ ะะพะดะบะปััะตะฝะธะต ะบ Kafka-UI

**Kafka-UI**: `http://localhost:8080`

## ๐งช ะะฐะฟััะบ ะฝะฐะณััะทะพัะฝะพะณะพ ัะตััะธัะพะฒะฐะฝะธั Locust

**Locust**: `http://localhost:8089`

## ๐ ะะธัะตะฝะทะธั

ะญัะพั ะฟัะพะตะบั ัะฐัะฟัะพัััะฐะฝัะตััั ะฟะพะด ะปะธัะตะฝะทะธะตะน MIT.
