# Мониторинг и логирование

## Обзор

В проекте реализована система логирования на основе стандартного модуля `logging` с JSON-форматированием. Логи выводятся в консоль в структурированном виде, что позволяет легко их анализировать с помощью различных инструментов.

## Конфигурация логирования

### Основные компоненты

1. **Кастомный JSON-форматтер** (`CustomJsonFormatter`)

   - Форматирует логи в JSON
   - Добавляет метаданные (время, уровень, сервис и т.д.)
   - Поддерживает исключения и кастомные теги

2. **Фильтры сервисов** (`ServiceNameFilter`)
   - Добавляет имя сервиса в логи
   - Позволяет различать логи от разных компонентов системы

## Использование в коде

### Инициализация логгера

```py
# Получение логгера для конкретного модуля
import logging.config
from core.logger import logger_config

logging.config.dictConfig(logger_config)
kafka_logger = logging.getLogger('kafka_logger')

# Логирование с дополнительными полями
kafka_logger.info('Сообщение успешно отправлено', extra={
    'tags': {
        'topic': settings.kafka.TOPIC,
        'event': event['event'],
        'task_title': event['task']['title'],
        'task_description': event['task']['description'],
    }
})
```

### Обработка ошибок

```py
try:
    # Код, который может вызвать исключение
    await repository.get_task(task_id)
except Exception as e:
    logger.error('Failed to get task', exc_info=e)
    raise
```

## Настройка логгеров

В проекте настроены следующие логгеры:

1. **task_repository_logger** - для логирования операций с репозиторием задач
2. **database_logger** - для логирования операций с базой данных
3. **handle_errors_logger** - для логирования ошибок
4. **uvicorn** - для логирования веб-сервера
5. **kafka** - для логирования работы с Kafka

Каждый логгер имеет свой фильтр, добавляющий соответствующее имя сервиса.
