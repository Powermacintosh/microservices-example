# Архитектура приложения

## Обзор

Приложение построено по микросервисной архитектуре с четким разделением ответственности между компонентами. Основные сервисы взаимодействуют через API и брокер сообщений (Kafka).

## Диаграмма компонентов

```mermaid
graph TD
    A[Клиент] -->|HTTP/HTTPS| B[API Gateway]
    B -->|HTTP| C[Сервис задач Tasks]
    C -->|SQL| D[(База данных)]
    B -->|Kafka| F[Брокер сообщений]
    F -->|События| G[Потребители событий]
    F -->|События| E[Другие сервисы]
    F -->|События| C[Сервис задач]
    B -->|HTTP| E[Другие сервисы]
```

## Основные компоненты

### 1. API Gateway

- Единая точка входа для всех клиентских запросов
- Маршрутизация запросов к соответствующим сервисам

#### В дальнейшем планируется добавить:

- Аутентификация и авторизация
- Балансировка нагрузки
- Кеширование

### 2. Сервис задач (Tasks)

#### Основные функции:

- Управление задачами (CRUD операции)
- Валидация данных
- Бизнес-логика работы с задачами
- Интеграция с другими сервисами через события

### 3. База данных

- Хранение данных приложения

### 4. Брокер сообщений (Kafka)

- Асинхронная коммуникация между сервисами
- Обработка событий
- Обеспечение надежности доставки сообщений

### 1. Создание задачи

```mermaid
sequenceDiagram
    participant C as Клиент
    participant G as Gateway
    participant T as Tasks Service
    participant D as База данных

    C->>G: POST /api/v1/task/create
    G->>T: Перенаправление запроса
    T->>D: Валидация и сохранение
    D-->>T: Успешное сохранение
    T-->>G: 201 Created
    G-->>C: Ответ
```

### 2. Обновление статуса задачи

```mermaid
sequenceDiagram
    participant C as Клиент
    participant G as Gateway
    participant T as Tasks Service
    participant D as База данных

    C->>G: PATCH /api/v1/tasks/{id}
    G->>T: Перенаправление запроса
    T->>D: Частичное обновление задачи
    D-->>T: Данные задачи
    T-->>G: 200 OK
    T-->>C: Обновленная задача
```

### 3. Создание задачи через Kafka

```mermaid
sequenceDiagram
    participant C as Клиент
    participant G as Gateway
    participant K as Kafka
    participant R as Tasks Repository
    participant D as База данных

    C->>G: POST /api/v1/task/create_event
    G->>K: Отправка события TaskCreation
    K-->>C: 201 Created, json.response {'status': 'published'}
    K->>R: Создание задачи
    R->>D: Валидация и сохранение
    D-->>R: Успешное сохранение
    R-->>K: commit(TaskCreation)

```
